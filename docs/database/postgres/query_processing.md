# Query Processing

The query processing contains following stages:

1. Parser: The parser generates a parse tree from an SQL statement in plain text.
2. Analyzer/Analyser: The analyzer/analyser carries out a semantic analysis of a parse tree and generates a query tree.
3. Rewriter: The rewriter transforms a query tree using the rules stored in the rule system if such rules exist.
4. Planner: The planner generates the plan tree that can most effectively be executed from the query tree.
5. Executor: The executor executes the query via accessing the tables and indexes in the order that was created by the plan tree.

![](https://user-images.githubusercontent.com/17776979/200611573-3493ef3a-60c8-4894-afbd-6e9c09f5ea29.png)

## Parser

The parser generates a parse tree that can be read by subsequent subsystems from an SQL statement in plain text.

![](https://user-images.githubusercontent.com/17776979/200611779-788c8311-bc07-488c-8926-6e1708674d1f.png)

The parser only checks the syntax of an input when generating a parse tree, it only returns an error if there is a syntax error in the query. The parser does not check the semantics of an input query. For example, even if the query contains a table name that does not exist, the parser does not return an error. Semantic checks are done by the analyzer/analyser.

## Analyzer/Analyser

The analyzer/analyser runs a semantic analysis of a parse tree generated by the parser and generates a query tree.

![](https://user-images.githubusercontent.com/17776979/200612222-7c790dec-282e-40fd-9e87-ca6e65e077ce.png) 

## Rewriter

The rewriter transforms a query tree according to the rules stored in the `pg_rules` system catalog if necessary

Find more information about rule system [here](https://www.sqlservercentral.com/articles/rules-in-postgresql)

## Planner and Executor

The planner receives a query tree from the rewriter and generates a (query) plan tree that can be processed by the executor most effectively.

A plan tree is composed of elements called plan nodes, and it is connected to the plantree list of the PlannedStmt structure. Each plan node has information that the executor requires for processing, and the executor processes from the end of the plan tree to the root in the case of a single-table query.

![](https://user-images.githubusercontent.com/17776979/200614885-c14c8451-b6e0-4101-9945-067b004dd0e3.png) 
